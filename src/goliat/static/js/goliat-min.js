Ext.ns("Goliat");Goliat.UserLoginWindow=Ext.extend(Ext.Window,{messages:{user_login:"Login",user:"User",password:"Password"},initComponent:function(){Ext.apply(this,{width:552,height:572,resizable:false,modal:true,closable:false,center:true,layout:"fit",iconCls:"icon_login",items:this.buildForm()});if(!this.bodyStyle){Ext.apply(this,{bodyStyle:"background: url(/goliat/resources/media/login.png) no-repeat; padding: 260px 0 0 174px;"})}Ext.applyIf(this,{url:"/login"});Goliat.UserLoginWindow.superclass.initComponent.call(this)},buildForm:function(){return{xtype:"form",itemId:"formPanel",defaultType:"textfield",labelWidth:72,border:false,bodyStyle:"background: transparent;",url:this.url,defaults:{allowBlank:false,labelSeparator:"",width:110,listeners:{scope:this,specialkey:function(b,a){if(a.getKey()===a.ENTER&&this.handler){this.handler.call(this.scope)}}}},items:[{fieldLabel:this.messages.user,name:"username"},{inputType:"password",fieldLabel:this.messages.password,name:"password"},{xtype:"button",style:"margin: 16px 0 0 64px;",iconCls:"icon_accept",width:70,text:this.messages.user_login,handler:this.handler,scope:this.scope||this}]}}});Ext.ns("Goliat.base");Goliat.base.DetailsPanel=Ext.extend(Ext.Panel,{defaultHeight:125,record:null,store:null,noRecordPanel:null,recordPanel:null,border:false,autoScroll:true,layout:"card",activeItem:0,getNoRecordPanel:function(){if(!this.noRecordPanel){this.noRecordPanel=new Ext.Panel(this.defaults)}return this.noRecordPanel},getRecordPanel:function(){if(!this.recordPanel){this.recordPanel=new Ext.Panel(this.defaults)}return this.recordPanel},showDefault:function(a){if(this.defaultTpl){this.defaultTpl.overwrite(a)}},updateDetails:function(b,a){this.tpl.overwrite(a,b.data)},initComponent:function(){this.defaults=this.defaults||{};Ext.applyIf(this.defaults,{border:false,autoScroll:true,layout:"fit"});this.items=[this.getNoRecordPanel(),this.getRecordPanel()];Goliat.base.DetailsPanel.superclass.initComponent.apply(this,arguments)},onDetailsUpdate:function(b){var a=b.getCount();if(a===0||b.isFilterSelect){this.layout.setActiveItem(this.getNoRecordPanel());this.showDefault(this.getNoRecordPanel().body);this.record=null}else{if(a===1){this.layout.setActiveItem(this.getRecordPanel());this.record=b.getSelected();this.updateDetails(this.record,this.getRecordPanel().body)}}},getLoadMask:function(){if(!this.loadMask){this.loadMask=new Ext.LoadMask(this.el)}return this.loadMask}});Ext.ns("Goliat.base");Goliat.base.FormPanel=Ext.extend(Ext.form.FormPanel,{constructor:function(a){a=a||{};Ext.applyIf(a,{trackResetOnLoad:true});Goliat.base.FormPanel.superclass.constructor.call(this,a);if(this.record){this.on({scope:this,render:{single:true,fn:this.loadFormAfterRender}})}},getValues:function(){return this.getForm().getValues()},isValid:function(){return this.getForm().isValid()},clearForm:function(){var b={};for(var a in this.getValues()){b[a]=""}this.setValues(b);this.data=null},reset:function(){this.getForm().reset()},loadData:function(a){if(a){this.data=a;this.setValues(a)}else{this.clearForm()}},setValues:function(a){return this.getForm().setValues(a||{})},get:function(o){if(!o.url){return{success:false,error:"No url setted."}}Ext.Ajax.request({method:"GET",url:o.url,params:{act:"get",id:o.id},scope:this,callback:function(options,success,request){try{var response=eval("("+request.responseText+")")}catch(e){}if(!response){Goliat.Msg.error(this.messages.transactionError,this)}else{if(response.success===false){Goliat.Msg.error(response.error,this)}else{if(o.callback){o.callback.call(this,response)}}}}})},loadFormAfterRender:function(){this.get({url:this.url,id:this.record.get("id"),callback:function(a){this.loadData(a.data)}})}});Ext.ns("Goliat.base");Goliat.base.ListPanel=Ext.extend(Ext.Panel,{layout:"fit",initComponent:function(){this.items=this.buildListView();Goliat.base.ListPanel.superclass.initComponent.call(this);this.relayEvents(this.getView(),["click"]);this.relayEvents(this.getStore(),["load"])},buildListView:function(){return{}},buildStore:function(){return{xtype:"jsonstore"}},clearView:function(){this.getStore().removeAll()},clearSelections:function(){return this.getView().clearSelections()},getView:function(){return this.items.items[0]},getStore:function(){return this.getView().store},getSelectedRecords:function(){return this.getView().getSelectedRecords()},getSelected:function(){return this.getSelectedRecords()[0]},refreshView:function(){this.getView().store.reload()},selectById:function(c){var a=this.getView();c=c||false;if(c){var b=a.store.find("id",c);a.select(b)}},loadStoreByParams:function(a){a=a||{};this.getStore().load({params:a})}});Ext.ns("Goliat.base");Goliat.base.GridPanel=Ext.extend(Ext.grid.GridPanel,{autoExpandColumn:1,flex:1,border:false,loadMask:true,trackMouseOver:false,useModelStore:false,iconCls:"icon_grid",viewConfig:{forceFit:true},enableHdMenu:false,initComponent:function(){this.colModel=this.buildColModel();this.selModel=this.buildSelModel();this.listeners=this.buildListeners();Goliat.base.GridPanel.superclass.initComponent.call(this,arguments);if(this.useModelStore){this.modelStore=this.buildModelStore()}else{this.store=this.buildStore()}},buildColModel:function(){return{}},buildSelModel:function(){return new Ext.grid.RowSelectionModel({singleSelect:false,listeners:{selectionchange:{scope:this,fn:this.listGrid_onSelectionChange}}})},buildStore:function(){return{xtype:"jsonstore"}},buildListeners:function(){return{scope:this,rowdblclick:this.listGrid_onRowDblClick}},buildModelStore:function(){if(!this.useModelStore){this.useModelStore=true}return new Goliat.ModelStore({autoLoad:true,url:this.modelUrl,fieldsOrder:this.columnsOrder,listeners:{scope:this,onload:this.buildColModelStore}})},buildColModelStore:function(){if(!this.modelStore.loaded){this.modelStore.setUrl(this.modelUrl);this.modelStore.load();this.modelStore.loaded=true}this.colModel=new Ext.grid.ColumnModel(this.modelStore.parseColumnModel());this.fixRelations();if(this.columnsHidden){this.hideColumns()}if(this.hidePK){this.hidePrimaryKeys()}this.store=this.modelStore.store},hideColumns:function(){for(c in this.columnsHidden){if(c==="remove"){continue}this.getColumnModel().setHidden(this.getColumnModel().getIndexById(this.columnsHidden[c]),true)}},hidePrimaryKeys:function(){for(c in this.getColumnsByPK()){if(c!=="remove"){this.getColumnModel().setHidden(this.getColumnModel().getIndexById(this.getColumnsByPK()[c].id),true)}}},getColumnsByPK:function(){return this.getColumnModel().getColumnsBy(function(a){return a.primary===true})},fixRelations:function(){for(var a=0;a<this.getColumnModel().getColumnCount();a++){if(this.getColumnModel().getColumnAt(a).relation===true){this.relations.push(this.getColumnModel().getColumnAt(a));this.getColumnModel().config.splice(a,1)}}},load:function(a){if(!this.useModelStore){return this.store.load(a)}return this.modelStore.store.load(a)},loadData:function(a){return this.store.loadData(a)},removeAll:function(){return this.store.removeAll()},remove:function(a){return this.store.remove(a)},getSelected:function(){return this.selModel.getSelections()},getSelectedId:function(){var a=this.selModel.getSelected();return a==null?"":a.data.id},listGrid_onRowDblClick:function(b,d){var a=this.store.getAt(d);new Goliat.EditorWindow({url:this.modelUrl,modelStore:this.modelStore,grid:this,record:a}).show()},listGrid_onSelectionChange:function(){return}});Ext.ns("Goliat");Goliat.SidePanel=Ext.extend(Ext.Panel,{messages:{menuAlreadyExists:"The component menu {0} with type {1} already exists at side panel. Skipping..."},autoScroll:true,layout:"accordion",layoutConfig:{hideCollapseTool:true,animate:true,fill:false},initComponent:function(){this.addEvents("log","debug","warn","error");Goliat.SidePanel.superclass.initComponent.call(this,arguments);if(this.url){Ext.Ajax.request({url:this.url,method:"GET",scope:this,callback:function(options,success,result){if(success==true){var jsonData;try{jsonData=Ext.decode(result.responseText)}catch(e){Goliat.Msg.error("The returned data is not valid data.",this)}if(jsonData.success==true){for(var i=0;i<jsonData.items.length;i++){tmpitem=jsonData.items[i];var item={};item.border=false;item.hideBorders=true;item.menuType=tmpitem.menuType;item.iconCls=tmpitem.iconCls;item.title=tmpitem.title;item.items=[];if(tmpitem.items){for(var x=0;x<tmpitem.items.length;x++){item.items.push({iconCls:tmpitem.items[x].iconCls,title:tmpitem.items[x].title,xtype:tmpitem.items[x].xtype,plugins:eval(tmpitem.items[x].plugins)})}}this.addMenu(item)}this.doLayout()}else{Goliat.Msg.error(jsonData.error,this)}}else{Goliat.Msg.error("SidePanel Error:",+this.url+" does not returned valid data!",this)}}})}},addMenu:function(d){var b=this.items.items;for(var a=0;a<b.length;a++){if(b[a].menuType==d.menuType){var c=String.format(this.messages.menuAlreadyExists,d.title,d.menuType);this.fireEvent("debug",this,c);return}}this.add(d)},removeMenu:function(c){var b=this.sidePanel.items.items;for(var a=0;a<b.length;a++){if(b[a].menuType==c){this.remove(b[a])}}}});Ext.reg("Goliat_sidepanel",Goliat.SidePanel);Goliat.SidePanelMenu=Ext.extend(Ext.Component,{iconCls:"",title:"",constructor:function(a){a=a||{};this.iconCls=a.iconCls||"no_icon";this.title=a.title||"Undefined";Goliat.SidePanelMenu.superclass.constructor.call(this,a)},initComponent:function(){this.html=String.format('<div class="taskbar_item"><img class="{0}" src="/extjs/resources/images/default/s.gif" />{1}</div>',this.iconCls,this.title);Goliat.SidePanelMenu.superclass.initComponent.call(this)}});Ext.reg("Goliat_sidepanel_menu",Goliat.SidePanelMenu);Ext.ns("Goliat");Goliat.TabPanel=Ext.extend(Ext.TabPanel,{messages:{tabAlreadyAdded:"The component panel {0} with type {1} already exists on panel. Skipping..."},initComponent:function(){this.addEvents("log","debug","warn","error");this.itemId="tabPanel";Goliat.TabPanel.superclass.initComponent.call(this)},addPanel:function(a,e){var c=this.items.items;for(var d=0;d<c.length;d++){if(Ext.isString(a)){if(c[d].getXType()===a&&Ext.encode(c[d].data)===Ext.encode(e)){this.activate(c[d]);return}}else{if(c[d].panelType==a.prototype.panelType&&Ext.encode(c[d].data)==Ext.encode(e)){this.activate(c[d]);return}}}if(!e){e={}}if(Ext.isString(a)){Ext.apply(e,{xtype:a});var b=this.add(e);this.activate(b.getItemId())}else{a=new a({data:e});this.add(a);this.activate(a)}}});Ext.reg("Goliat_tabpanel",Goliat.TabPanel);Ext.lib.Ajax.isCrossDomain=function(b){var a=/(?:(\w*:)\/\/)?([\w\.]*(?::\d*)?)/.exec(b);if(!a[1]){return false}return(a[1]!=location.protocol)||(a[2]!=location.host)};Ext.override(Ext.data.Connection,{request:function(e){if(this.fireEvent("beforerequest",this,e)!==false){var c=e.params;if(typeof c=="function"){c=c.call(e.scope||window,e)}if(typeof c=="object"){c=Ext.urlEncode(c)}if(this.extraParams){var h=Ext.urlEncode(this.extraParams);c=c?(c+"&"+h):h}var b=e.url||this.url;if(typeof b=="function"){b=b.call(e.scope||window,e)}if(e.form){var d=Ext.getDom(e.form);b=b||d.action;var j=d.getAttribute("enctype");if(e.isUpload||(j&&j.toLowerCase()=="multipart/form-data")){return this.doFormUpload(e,c,b)}var i=Ext.lib.Ajax.serializeForm(d);c=c?(c+"&"+i):i}var k=e.headers;if(this.defaultHeaders){k=Ext.apply(k||{},this.defaultHeaders);if(!e.headers){e.headers=k}}var g={success:this.handleResponse,failure:this.handleFailure,scope:this,argument:{options:e},timeout:this.timeout};var a=e.method||this.method||(c?"POST":"GET");if(a=="GET"&&(this.disableCaching&&e.disableCaching!==false)||e.disableCaching===true){b+=(b.indexOf("?")!=-1?"&":"?")+"_dc="+(new Date().getTime())}if(typeof e.autoAbort=="boolean"){if(e.autoAbort){this.abort()}}else{if(this.autoAbort!==false){this.abort()}}if((a=="GET"&&c)||e.xmlData||e.jsonData){b+=(b.indexOf("?")!=-1?"&":"?")+c;c=""}if(e.scriptTag||this.scriptTag||Ext.lib.Ajax.isCrossDomain(b)){this.transId=this.scriptRequest(a,b,g,c,e)}else{this.transId=Ext.lib.Ajax.request(a,b,g,c,e)}return this.transId}else{Ext.callback(e.callback,e.scope,[e,null,null]);return null}},scriptRequest:function(a,c,e,f,i){var b=++Ext.data.ScriptTagProxy.TRANS_ID;var h={id:b,cb:i.callbackName||"stcCallback"+b,scriptId:"stcScript"+b,options:i};c+=(c.indexOf("?")!=-1?"&":"?")+f+String.format("&{0}={1}",i.callbackParam||this.callbackParam||"callback",h.cb);var d=this;window[h.cb]=function(j){d.handleScriptResponse(j,h)};h.timeoutId=this.handleScriptFailure.defer(e.timeout,this,[h]);var g=document.createElement("script");g.setAttribute("src",c);g.setAttribute("type","text/javascript");g.setAttribute("id",h.scriptId);document.getElementsByTagName("head")[0].appendChild(g);return h},handleScriptResponse:function(d,b){this.transId=false;this.destroyScriptTrans(b,true);var a=b.options;var c;if(typeof d=="string"){if(window.ActiveXObject){c=new ActiveXObject("Microsoft.XMLDOM");c.async="false";c.loadXML(d)}else{c=new DOMParser().parseFromString(d,"text/xml")}}response={responseObject:d,responseText:(typeof d=="object")?Ext.util.JSON.encode(d):String(d),responseXML:c,argument:a.argument};this.fireEvent("requestcomplete",this,response,a);Ext.callback(a.success,a.scope,[response,a]);Ext.callback(a.callback,a.scope,[a,true,response])},handleScriptFailure:function(b){this.transId=false;this.destroyScriptTrans(b,false);var a=b.options;response={argument:a.argument,status:500,statusText:"Server failed to respond",responseText:""};this.fireEvent("requestexception",this,response,a,{status:-1,statusText:"communication failure"});Ext.callback(a.failure,a.scope,[response,a]);Ext.callback(a.callback,a.scope,[a,false,response])},destroyScriptTrans:function(b,a){document.getElementsByTagName("head")[0].removeChild(document.getElementById(b.scriptId));clearTimeout(b.timeoutId);if(a){window[b.cb]=undefined;try{delete window[b.cb]}catch(c){}}else{window[b.cb]=function(){window[b.cb]=undefined;try{delete window[b.cb]}catch(d){}}}}});Ext.ns("Goliat.session");Goliat.session.Session=Ext.extend(Ext.util.Observable,{uid:null,sid:"",name:"Anonymous",groups:[],creation_date:"",last_login:"",active:false,userProfile:{},sessionData:{},messages:{title:"Autentication",mask:"Please wait...",logout:"Are you sure do you want to close your session?",mask_logout:"Disconnecting...",trans_err:"Web transaction failed!.",invalid:"The returned data is not valid data.",401:"Username or Password mismatch.",409:"Already Logged."},constructor:function(a){Ext.apply(this,a);this.addEvents({login:true,logout:true,checked:true});Goliat.session.Session.superclass.constructor.call(this);if(this.tpl){if(typeof this.tpl=="string"){this.tpl=new Ext.Template(this.tpl)}this.tpl.compile()}Ext.applyIf(this,{loginWindow:new Goliat.UserLoginWindow({title:this.messages.login,scope:this,handler:this.onLogin,url:"/login"}),logout:"/logout"})},onLogin:function(){var a=this.loginWindow.get(0);if(a.getForm().isValid()){this.loginWindow.el.mask(this.messages.mask,"x-mask-loading");a.getForm().submit({success:function(b,c){this.onLoginSuccess(c.result.session)},failure:this.onLoginFail,scope:this})}},onLoginSuccess:function(a){this.loginWindow.el.unmask();Ext.apply(this,a);this.loginWindow.close();this.fireEvent("login",this)},onLoginFail:function(form,response){this.loginWindow.el.unmask();eval("var err = "+response.response.responseText);if(!this.messages[err.error]){Goliat.Msg.alert(err.message,this)}else{Goliat.Msg.alert(this.messages[err.error],this)}},onLogout:function(){Goliat.Msg.confirm(this.messages.logout,this,function(a){if(a=="yes"){this.doLogout()}})},doLogout:function(){Ext.getBody().mask(this.messages.mask_logout,"x-mask-loading");Ext.Ajax.request({method:"POST",url:this.logout,scope:this,callback:this.onAfterAjaxReq,succCallback:this.onAfterLogout,failCallback:function(){Goliat.Msg.error("Web transaction failed!",this)}})},onAfterLogout:function(){this.uid=null;this.userData={};this.fireEvent("logout",this)},onAfterAjaxReq:function(b,f,a){Ext.getBody().unmask();if(f==true){var c;try{c=Ext.decode(a.responseText)}catch(d){Goliat.Msg.error(this.messages.invalid,this)}b.succCallback.call(b.scope,c,b)}else{b.failCallback.call(b.scope,c,b)}},check:function(){Ext.Ajax.request({method:"GET",url:this.loginWindow.url,scope:this,callback:this.onAfterAjaxReq,succCallback:function(jsonData,options){if(jsonData.success){Ext.apply(this,eval(jsonData.session));this.fireEvent("checked",this)}else{if(this.failCheckCallback){if(!this.failCheckCallback(jsonData,options)){this.loginWindow.show()}}else{this.loginWindow.show()}}},failCallback:function(){Goliat.Msg.error(this.messages.trans_err,this)}})},getData:function(){return this.sessionData},getUserProfile:function(){return this.userProfile},getUid:function(){return this.uid},getSid:function(){return this.sid},getGroups:function(){return this.groups},getCreationDate:function(){return this.creation_date},getLastLogin:function(){return this.last_login},isActive:function(){return this.active},hasGroup:function(a){if(this.groups.indexOf(a)==-1){return false}else{return true}},addGroup:function(a){if(this.groups.indexOf(a)==-1){this.groups.push(a)}},removeGroup:function(a){if(this.hasGroup(a)){this.groups.splice(this.groups.indexOf(a),1)}}});/*
 * Ext JS Library 3.2.1
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ns("Ext.ux.grid");Ext.ux.grid.RowExpander=Ext.extend(Ext.util.Observable,{expandOnEnter:true,expandOnDblClick:true,header:"",width:20,sortable:false,fixed:true,hideable:false,menuDisabled:true,dataIndex:"",id:"expander",lazyRender:true,enableCaching:true,constructor:function(a){Ext.apply(this,a);this.addEvents({beforeexpand:true,expand:true,beforecollapse:true,collapse:true});Ext.ux.grid.RowExpander.superclass.constructor.call(this);if(this.tpl){if(typeof this.tpl=="string"){this.tpl=new Ext.Template(this.tpl)}this.tpl.compile()}this.state={};this.bodyContent={}},getRowClass:function(a,e,d,c){d.cols=d.cols-1;var b=this.bodyContent[a.id];if(!b&&!this.lazyRender){b=this.getBodyContent(a,e)}if(b){d.body=b}return this.state[a.id]?"x-grid3-row-expanded":"x-grid3-row-collapsed"},init:function(b){this.grid=b;var a=b.getView();a.getRowClass=this.getRowClass.createDelegate(this);a.enableRowBody=true;b.on("render",this.onRender,this);b.on("destroy",this.onDestroy,this)},onRender:function(){var a=this.grid;var b=a.getView().mainBody;b.on("mousedown",this.onMouseDown,this,{delegate:".x-grid3-row-expander"});if(this.expandOnEnter){this.keyNav=new Ext.KeyNav(this.grid.getGridEl(),{enter:this.onEnter,scope:this})}if(this.expandOnDblClick){a.on("rowdblclick",this.onRowDblClick,this)}},onDestroy:function(){if(this.keyNav){this.keyNav.disable();delete this.keyNav}var a=this.grid.getView().mainBody;if(a){a.un("mousedown",this.onMouseDown,this)}},onRowDblClick:function(a,b,c){this.toggleRow(b)},onEnter:function(h){var f=this.grid;var j=f.getSelectionModel();var b=j.getSelections();for(var c=0,a=b.length;c<a;c++){var d=f.getStore().indexOf(b[c]);this.toggleRow(d)}},getBodyContent:function(a,b){if(!this.enableCaching){return this.tpl.apply(a.data)}var c=this.bodyContent[a.id];if(!c){c=this.tpl.apply(a.data);this.bodyContent[a.id]=c}return c},onMouseDown:function(b,a){b.stopEvent();var c=b.getTarget(".x-grid3-row");this.toggleRow(c)},renderer:function(b,c,a){c.cellAttr='rowspan="2"';return'<div class="x-grid3-row-expander">&#160;</div>'},beforeExpand:function(b,a,c){if(this.fireEvent("beforeexpand",this,b,a,c)!==false){if(this.tpl&&this.lazyRender){a.innerHTML=this.getBodyContent(b,c)}return true}else{return false}},toggleRow:function(a){if(typeof a=="number"){a=this.grid.view.getRow(a)}this[Ext.fly(a).hasClass("x-grid3-row-collapsed")?"expandRow":"collapseRow"](a)},expandRow:function(c){if(typeof c=="number"){c=this.grid.view.getRow(c)}var b=this.grid.store.getAt(c.rowIndex);var a=Ext.DomQuery.selectNode("tr:nth(2) div.x-grid3-row-body",c);if(this.beforeExpand(b,a,c.rowIndex)){this.state[b.id]=true;Ext.fly(c).replaceClass("x-grid3-row-collapsed","x-grid3-row-expanded");this.fireEvent("expand",this,b,a,c.rowIndex)}},collapseRow:function(c){if(typeof c=="number"){c=this.grid.view.getRow(c)}var b=this.grid.store.getAt(c.rowIndex);var a=Ext.fly(c).child("tr:nth(1) div.x-grid3-row-body",true);if(this.fireEvent("beforecollapse",this,b,a,c.rowIndex)!==false){this.state[b.id]=false;Ext.fly(c).replaceClass("x-grid3-row-expanded","x-grid3-row-collapsed");this.fireEvent("collapse",this,b,a,c.rowIndex)}}});Ext.preg("rowexpander",Ext.ux.grid.RowExpander);Ext.grid.RowExpander=Ext.ux.grid.RowExpander;Ext.namespace("Ext.ux","Ext.ux.layout","Ext.ux.Wiz");Ext.ux.layout.CardLayout=Ext.extend(Ext.layout.CardLayout,{setActiveItem:function(b){b=this.container.getComponent(b);if(this.activeItem!=b){if(this.activeItem){this.activeItem.hide()}if(this.activeItem&&!this.activeItem.hidden){return}var a=b.doLayout&&(this.layoutOnCardChange||!b.rendered);this.activeItem=b;b.show();this.layout();if(a){b.doLayout()}}}});Ext.ux.Wiz=Ext.extend(Ext.Window,{loadMaskConfig:{"default":"Saving..."},height:400,width:540,closable:true,resizable:false,modal:true,cards:null,previousButtonText:"&lt; Previous",nextButtonText:"Next &gt;",cancelButtonText:"Cancel",finishButtonText:"Finish",headerConfig:{},cardPanelConfig:{},previousButton:null,nextButton:null,cancelButton:null,cardPanel:null,currentCard:-1,headPanel:null,cardCount:0,initComponent:function(){this.initButtons();this.initPanels();var a=this.title||this.headerConfig.title;a=a||"";Ext.apply(this,{title:a,layout:"border",cardCount:this.cards.length,buttons:[this.previousButton,this.nextButton,this.cancelButton],items:[this.headPanel,this.cardPanel]});this.addEvents("cancel","finish");Ext.ux.Wiz.superclass.initComponent.call(this)},getWizardData:function(){var d={};var c=this.cards;for(var b=0,a=c.length;b<a;b++){if(c[b].form){d[c[b].id]=c[b].form.getValues(false)}else{d[c[b].id]={}}}return d},switchDialogState:function(a,c){this.showLoadMask(!a,c);this.previousButton.setDisabled(!a);this.nextButton.setDisabled(!a);this.cancelButton.setDisabled(!a);var b=this.tools.close;if(b){switch(a){case true:this.tools.close.unmask();break;default:this.tools.close.mask();break}}this.closable=a},showLoadMask:function(a,b){if(!b){b="default"}if(a){if(this.loadMask==null){this.loadMask=new Ext.LoadMask(this.body)}this.loadMask.msg=this.loadMaskConfig[b];this.loadMask.show()}else{if(this.loadMask){this.loadMask.hide()}}},initEvents:function(){Ext.ux.Wiz.superclass.initEvents.call(this);this.on("beforeclose",this.onBeforeClose,this)},initPanels:function(){var d=this.cards;var c=this.cardPanelConfig;Ext.apply(this.headerConfig,{steps:d.length});this.headPanel=new Ext.ux.Wiz.Header(this.headerConfig);Ext.apply(c,{layout:new Ext.ux.layout.CardLayout(),items:d});Ext.applyIf(c,{region:"center",border:false,activeItem:0});var d=this.cards;for(var b=0,a=d.length;b<a;b++){d[b].on("show",this.onCardShow,this);d[b].on("hide",this.onCardHide,this);d[b].on("clientvalidation",this.onClientValidation,this)}this.cardPanel=new Ext.Panel(c)},initButtons:function(){this.previousButton=new Ext.Button({text:this.previousButtonText,disabled:true,minWidth:75,handler:this.onPreviousClick,scope:this});this.nextButton=new Ext.Button({text:this.nextButtonText,minWidth:75,handler:this.onNextClick,scope:this});this.cancelButton=new Ext.Button({text:this.cancelButtonText,handler:this.onCancelClick,scope:this,minWidth:75})},onBeforeClose:function(a){return this.closable},onClientValidation:function(a,b){if(!b){this.nextButton.setDisabled(true)}else{this.nextButton.setDisabled(false)}},onCardHide:function(a){if(this.cardPanel.layout.activeItem.id===a.id){this.nextButton.setDisabled(true)}},onCardShow:function(c){var e=c.ownerCt;var b=e.items;for(var d=0,a=b.length;d<a;d++){if(b.get(d).id==c.id){break}}this.currentCard=d;this.headPanel.updateStep(d,c.title);if(d==a-1){this.nextButton.setText(this.finishButtonText)}else{this.nextButton.setText(this.nextButtonText)}if(c.isValid()){this.nextButton.setDisabled(false)}if(d==0){this.previousButton.setDisabled(true)}else{this.previousButton.setDisabled(false)}},onCancelClick:function(){if(this.fireEvent("cancel",this)!==false){this.close()}},onFinish:function(){if(this.fireEvent("finish",this,this.getWizardData())!==false){this.close()}},onPreviousClick:function(){if(this.currentCard>0){this.cardPanel.getLayout().setActiveItem(this.currentCard-1)}},onNextClick:function(){if(this.currentCard==this.cardCount-1){this.onFinish()}else{this.cardPanel.getLayout().setActiveItem(this.currentCard+1)}}});Ext.ux.Wiz.Card=Ext.extend(Ext.FormPanel,{header:false,hideMode:"display",initComponent:function(){this.addEvents("beforecardhide");Ext.ux.Wiz.Card.superclass.initComponent.call(this)},isValid:function(){if(this.monitorValid){return this.bindHandler()}return true},bindHandler:function(){this.form.items.each(function(a){if(!a.isValid){a.isValid=Ext.emptyFn}});Ext.ux.Wiz.Card.superclass.bindHandler.call(this)},initEvents:function(){var a=this.monitorValid;this.monitorValid=false;Ext.ux.Wiz.Card.superclass.initEvents.call(this);this.monitorValid=a;this.on("beforehide",this.bubbleBeforeHideEvent,this);this.on("beforecardhide",this.isValid,this);this.on("show",this.onCardShow,this);this.on("hide",this.onCardHide,this)},bubbleBeforeHideEvent:function(){var a=this.ownerCt.layout;var b=a.activeItem;if(b&&b.id===this.id){return this.fireEvent("beforecardhide",this)}return true},onCardHide:function(){if(this.monitorValid){this.stopMonitoring()}},onCardShow:function(){if(this.monitorValid){this.startMonitoring()}}});Ext.ux.Wiz.Header=Ext.extend(Ext.BoxComponent,{height:55,region:"north",title:"Wizard",steps:0,stepText:"Step {0} of {1}: {2}",autoEl:{tag:"div",cls:"ext-ux-wiz-Header",children:[{tag:"div",cls:"ext-ux-wiz-Header-title"},{tag:"div",children:[{tag:"div",cls:"ext-ux-wiz-Header-step"},{tag:"div",cls:"ext-ux-wiz-Header-stepIndicator-container"}]}]},titleEl:null,stepEl:null,imageContainer:null,indicators:null,stepTemplate:null,lastActiveStep:-1,updateStep:function(b,c){var a=this.stepTemplate.apply({0:b+1,1:this.steps,2:c});this.stepEl.update(a);if(this.lastActiveStep!=-1){this.indicators[this.lastActiveStep].removeClass("ext-ux-wiz-Header-stepIndicator-active")}this.indicators[b].addClass("ext-ux-wiz-Header-stepIndicator-active");this.lastActiveStep=b},onRender:function(d,b){Ext.ux.Wiz.Header.superclass.onRender.call(this,d,b);this.indicators=[];this.stepTemplate=new Ext.Template(this.stepText);this.stepTemplate.compile();var f=this.el.dom.firstChild;var e=f.nextSibling;this.titleEl=new Ext.Element(f);this.stepEl=new Ext.Element(e.firstChild);this.imageContainer=new Ext.Element(e.lastChild);this.titleEl.update(this.title);var g=null;for(var c=0,a=this.steps;c<a;c++){g=document.createElement("div");g.innerHTML="&#160;";g.className="ext-ux-wiz-Header-stepIndicator";this.indicators[c]=new Ext.Element(g);this.imageContainer.appendChild(g)}}});Ext.namespace("Ext.ux.form");Ext.ux.form.SuperBoxSelect=function(a){Ext.ux.form.SuperBoxSelect.superclass.constructor.call(this,a);this.addEvents("beforeadditem","additem","newitem","beforeremoveitem","removeitem","clear")};Ext.ux.form.SuperBoxSelect=Ext.extend(Ext.ux.form.SuperBoxSelect,Ext.form.ComboBox,{allowAddNewData:false,backspaceDeletesLastItem:true,classField:null,clearBtnCls:"",displayFieldTpl:null,extraItemCls:"",extraItemStyle:"",expandBtnCls:"",fixFocusOnTabSelect:true,forceFormValue:true,itemDelimiterKey:Ext.EventObject.ENTER,navigateItemsWithTab:true,pinList:true,preventDuplicates:true,queryValuesDelimiter:"|",queryValuesIndicator:"valuesqry",removeValuesFromStore:true,renderFieldBtns:true,stackItems:false,styleField:null,supressClearValueRemoveEvents:false,validationEvent:"blur",valueDelimiter:",",initComponent:function(){Ext.apply(this,{items:new Ext.util.MixedCollection(false),usedRecords:new Ext.util.MixedCollection(false),addedRecords:[],remoteLookup:[],hideTrigger:true,grow:false,resizable:false,multiSelectMode:false,preRenderValue:null});if(this.transform){this.doTransform()}if(this.forceFormValue){this.items.on({add:this.manageNameAttribute,remove:this.manageNameAttribute,clear:this.manageNameAttribute,scope:this})}Ext.ux.form.SuperBoxSelect.superclass.initComponent.call(this);if(this.mode==="remote"&&this.store){this.store.on("load",this.onStoreLoad,this)}},onRender:function(b,a){var c=this.hiddenName;this.hiddenName=null;Ext.ux.form.SuperBoxSelect.superclass.onRender.call(this,b,a);this.hiddenName=c;this.manageNameAttribute();var d=(this.stackItems===true)?"x-superboxselect-stacked":"";if(this.renderFieldBtns){d+=" x-superboxselect-display-btns"}this.el.removeClass("x-form-text").addClass("x-superboxselect-input-field");this.wrapEl=this.el.wrap({tag:"ul"});this.outerWrapEl=this.wrapEl.wrap({tag:"div",cls:"x-form-text x-superboxselect "+d});this.inputEl=this.el.wrap({tag:"li",cls:"x-superboxselect-input"});if(this.renderFieldBtns){this.setupFieldButtons().manageClearBtn()}this.setupFormInterception()},onStoreLoad:function(b,a,c){var f=c.params[this.queryParam]||b.baseParams[this.queryParam]||"",g=c.params[this.queryValuesIndicator]||b.baseParams[this.queryValuesIndicator];if(this.removeValuesFromStore){this.store.each(function(i){if(this.usedRecords.containsKey(i.get(this.valueField))){this.store.remove(i)}},this)}if(g){var h=f.split(this.queryValuesDelimiter);Ext.each(h,function(i){this.remoteLookup.remove(i);var j=this.findRecord(this.valueField,i);if(j){this.addRecord(j)}},this);if(this.setOriginal){this.setOriginal=false;this.originalValue=this.getValue()}}if(f!==""&&this.allowAddNewData){Ext.each(this.remoteLookup,function(i){if(typeof i=="object"&&i[this.displayField]==f){this.remoteLookup.remove(i);if(a.length&&a[0].get(this.displayField)===f){this.addRecord(a[0]);return}var j=this.createRecord(i);this.store.add(j);this.addRecord(j);this.addedRecords.push(j);(function(){if(this.isExpanded()){this.collapse()}}).defer(10,this);return}},this)}var d=[];if(f===""){Ext.each(this.addedRecords,function(i){if(this.preventDuplicates&&this.usedRecords.containsKey(i.get(this.valueField))){return}d.push(i)},this)}else{var e=new RegExp(Ext.escapeRe(f)+".*","i");Ext.each(this.addedRecords,function(i){if(this.preventDuplicates&&this.usedRecords.containsKey(i.get(this.valueField))){return}if(e.test(i.get(this.displayField))){d.push(i)}},this)}this.store.add(d);this.store.sort(this.displayField,"ASC");if(this.store.getCount()===0&&this.isExpanded()){this.collapse()}},doTransform:function(){var m=Ext.getDom(this.transform),f=[];if(!this.store){this.mode="local";var h=[],a=m.options;for(var e=0,g=a.length;e<g;e++){var c=a[e],l=Ext.get(c),j=l.getAttributeNS(null,"value")||"",k=l.getAttributeNS(null,"className")||"",b=l.getAttributeNS(null,"style")||"";if(c.selected){f.push(j)}h.push([j,c.text,k,typeof(b)==="string"?b:b.cssText])}this.store=new Ext.data.SimpleStore({id:0,fields:["value","text","cls","style"],data:h});Ext.apply(this,{valueField:"value",displayField:"text",classField:"cls",styleField:"style"})}if(f.length){this.value=f.join(",")}},setupFieldButtons:function(){this.buttonWrap=this.outerWrapEl.createChild({cls:"x-superboxselect-btns"});this.buttonClear=this.buttonWrap.createChild({tag:"div",cls:"x-superboxselect-btn-clear "+this.clearBtnCls});this.buttonExpand=this.buttonWrap.createChild({tag:"div",cls:"x-superboxselect-btn-expand "+this.expandBtnCls});this.initButtonEvents();return this},initButtonEvents:function(){this.buttonClear.addClassOnOver("x-superboxselect-btn-over").on("click",function(a){a.stopEvent();if(this.disabled){return}this.clearValue();this.el.focus()},this);this.buttonExpand.addClassOnOver("x-superboxselect-btn-over").on("click",function(a){a.stopEvent();if(this.disabled){return}if(this.isExpanded()){this.multiSelectMode=false}else{if(this.pinList){this.multiSelectMode=true}}this.onTriggerClick()},this)},removeButtonEvents:function(){this.buttonClear.removeAllListeners();this.buttonExpand.removeAllListeners();return this},clearCurrentFocus:function(){if(this.currentFocus){this.currentFocus.onLnkBlur();this.currentFocus=null}return this},initEvents:function(){var a=this.el;a.on({click:this.onClick,focus:this.clearCurrentFocus,blur:this.onBlur,keydown:this.onKeyDownHandler,keyup:this.onKeyUpBuffered,scope:this});this.on({collapse:this.onCollapse,expand:this.clearCurrentFocus,scope:this});this.wrapEl.on("click",this.onWrapClick,this);this.outerWrapEl.on("click",this.onWrapClick,this);this.inputEl.focus=function(){a.focus()};Ext.ux.form.SuperBoxSelect.superclass.initEvents.call(this);Ext.apply(this.keyNav,{tab:function(b){if(this.fixFocusOnTabSelect&&this.isExpanded()){b.stopEvent();a.blur();this.onViewClick(false);this.focus(false,10);return true}this.onViewClick(false);if(a.dom.value!==""){this.setRawValue("")}return true},down:function(b){if(!this.isExpanded()&&!this.currentFocus){this.onTriggerClick()}else{this.inKeyMode=true;this.selectNext()}},enter:function(){}})},onClick:function(){this.clearCurrentFocus();this.collapse();this.autoSize()},beforeBlur:Ext.form.ComboBox.superclass.beforeBlur,onFocus:function(){this.outerWrapEl.addClass(this.focusClass);Ext.ux.form.SuperBoxSelect.superclass.onFocus.call(this)},onBlur:function(){this.outerWrapEl.removeClass(this.focusClass);this.clearCurrentFocus();if(this.el.dom.value!==""){this.applyEmptyText();this.autoSize()}Ext.ux.form.SuperBoxSelect.superclass.onBlur.call(this)},onCollapse:function(){this.view.clearSelections();this.multiSelectMode=false},onWrapClick:function(a){a.stopEvent();this.collapse();this.el.focus();this.clearCurrentFocus()},markInvalid:function(c){var b,a;if(!this.rendered||this.preventMark){return}this.outerWrapEl.addClass(this.invalidClass);c=c||this.invalidText;switch(this.msgTarget){case"qtip":Ext.apply(this.el.dom,{qtip:c,qclass:"x-form-invalid-tip"});Ext.apply(this.wrapEl.dom,{qtip:c,qclass:"x-form-invalid-tip"});if(Ext.QuickTips){Ext.QuickTips.enable()}break;case"title":this.el.dom.title=c;this.wrapEl.dom.title=c;this.outerWrapEl.dom.title=c;break;case"under":if(!this.errorEl){b=this.getErrorCt();if(!b){this.el.dom.title=c;break}this.errorEl=b.createChild({cls:"x-form-invalid-msg"});this.errorEl.setWidth(b.getWidth(true)-20)}this.errorEl.update(c);Ext.form.Field.msgFx[this.msgFx].show(this.errorEl,this);break;case"side":if(!this.errorIcon){b=this.getErrorCt();if(!b){this.el.dom.title=c;break}this.errorIcon=b.createChild({cls:"x-form-invalid-icon"})}this.alignErrorIcon();Ext.apply(this.errorIcon.dom,{qtip:c,qclass:"x-form-invalid-tip"});this.errorIcon.show();this.on("resize",this.alignErrorIcon,this);break;default:a=Ext.getDom(this.msgTarget);a.innerHTML=c;a.style.display=this.msgDisplay;break}this.fireEvent("invalid",this,c)},clearInvalid:function(){if(!this.rendered||this.preventMark){return}this.outerWrapEl.removeClass(this.invalidClass);switch(this.msgTarget){case"qtip":this.el.dom.qtip="";this.wrapEl.dom.qtip="";break;case"title":this.el.dom.title="";this.wrapEl.dom.title="";this.outerWrapEl.dom.title="";break;case"under":if(this.errorEl){Ext.form.Field.msgFx[this.msgFx].hide(this.errorEl,this)}break;case"side":if(this.errorIcon){this.errorIcon.dom.qtip="";this.errorIcon.hide();this.un("resize",this.alignErrorIcon,this)}break;default:var a=Ext.getDom(this.msgTarget);a.innerHTML="";a.style.display="none";break}this.fireEvent("valid",this)},alignErrorIcon:function(){if(this.wrap){this.errorIcon.alignTo(this.wrap,"tl-tr",[Ext.isIE?5:2,3])}},expand:function(){if(this.isExpanded()||!this.hasFocus){return}this.list.alignTo(this.outerWrapEl,this.listAlign).show();this.innerList.setOverflow("auto");Ext.getDoc().on({mousewheel:this.collapseIf,mousedown:this.collapseIf,scope:this});this.fireEvent("expand",this)},restrictHeight:function(){var b=this.innerList.dom,c=b.scrollTop,f=this.list;b.style.height="";var g=f.getFrameWidth("tb")+(this.resizable?this.handleHeight:0)+this.assetHeight,d=Math.max(b.clientHeight,b.offsetHeight,b.scrollHeight),a=this.getPosition()[1]-Ext.getBody().getScroll().top,i=Ext.lib.Dom.getViewHeight()-a-this.getSize().height,e=Math.max(a,i,this.minHeight||0)-f.shadowOffset-g-5;d=Math.min(d,e,this.maxHeight);this.innerList.setHeight(d);f.beginUpdate();f.setHeight(d+g);f.alignTo(this.outerWrapEl,this.listAlign);f.endUpdate();if(this.multiSelectMode){b.scrollTop=c}},validateValue:function(a){if(this.items.getCount()===0){if(this.allowBlank){this.clearInvalid();return true}else{this.markInvalid(this.blankText);return false}}this.clearInvalid();return true},manageNameAttribute:function(){if(this.items.getCount()===0&&this.forceFormValue){this.el.dom.setAttribute("name",this.hiddenName||this.name)}else{this.el.dom.removeAttribute("name")}},setupFormInterception:function(){var a;this.findParentBy(function(c){if(c.getForm){a=c.getForm()}});if(a){var b=a.getValues;a.getValues=function(d){this.el.dom.disabled=true;var c=this.el.dom.value;this.setRawValue("");var e=b.call(a);this.el.dom.disabled=false;this.setRawValue(c);if(this.forceFormValue&&this.items.getCount()===0){e[this.name]=""}return d?Ext.urlEncode(e):e}.createDelegate(this)}},onResize:function(a,c,e,b){var d=Ext.isIE6?4:Ext.isIE7?1:Ext.isIE8?1:0;if(this.wrapEl){this._width=a;this.outerWrapEl.setWidth(a-d);if(this.renderFieldBtns){d+=(this.buttonWrap.getWidth()+20);this.wrapEl.setWidth(a-d)}}Ext.ux.form.SuperBoxSelect.superclass.onResize.call(this,a,c,e,b);this.autoSize()},onEnable:function(){Ext.ux.form.SuperBoxSelect.superclass.onEnable.call(this);this.items.each(function(a){a.enable()});if(this.renderFieldBtns){this.initButtonEvents()}},onDisable:function(){Ext.ux.form.SuperBoxSelect.superclass.onDisable.call(this);this.items.each(function(a){a.disable()});if(this.renderFieldBtns){this.removeButtonEvents()}},clearValue:function(a){Ext.ux.form.SuperBoxSelect.superclass.clearValue.call(this);this.preventMultipleRemoveEvents=a||this.supressClearValueRemoveEvents||false;this.removeAllItems();this.preventMultipleRemoveEvents=false;this.fireEvent("clear",this);return this},onKeyUp:function(a){if(this.editable!==false&&(!a.isSpecialKey()||a.getKey()===a.BACKSPACE)&&a.getKey()!==this.itemDelimiterKey&&(!a.hasModifier()||a.shiftKey)){this.lastKey=a.getKey();this.dqTask.delay(this.queryDelay)}},onKeyDownHandler:function(g,c){var b,i,a;if((g.getKey()===g.DELETE||g.getKey()===g.SPACE)&&this.currentFocus){g.stopEvent();b=this.currentFocus;this.on("expand",function(){this.collapse()},this,{single:true});a=this.items.indexOfKey(this.currentFocus.key);this.clearCurrentFocus();if(a<(this.items.getCount()-1)){i=this.items.itemAt(a+1)}b.preDestroy(true);if(i){(function(){i.onLnkFocus();this.currentFocus=i}).defer(200,this)}return true}var h=this.el.dom.value,d,f=g.ctrlKey;if(g.getKey()===this.itemDelimiterKey){g.stopEvent();if(h!==""){if(f||!this.isExpanded()){this.view.clearSelections();this.collapse();this.setRawValue("");this.fireEvent("newitem",this,h)}else{this.onViewClick();if(this.unsetDelayCheck){this.delayedCheck=true;this.unsetDelayCheck.defer(10,this)}}}else{if(!this.isExpanded()){return}this.onViewClick();if(this.unsetDelayCheck){this.delayedCheck=true;this.unsetDelayCheck.defer(10,this)}}return true}if(h!==""){this.autoSize();return}if(g.getKey()===g.HOME){g.stopEvent();if(this.items.getCount()>0){this.collapse();d=this.items.get(0);d.el.focus()}return true}if(g.getKey()===g.BACKSPACE){g.stopEvent();if(this.currentFocus){b=this.currentFocus;this.on("expand",function(){this.collapse()},this,{single:true});a=this.items.indexOfKey(b.key);this.clearCurrentFocus();if(a<(this.items.getCount()-1)){i=this.items.itemAt(a+1)}b.preDestroy(true);if(i){(function(){i.onLnkFocus();this.currentFocus=i}).defer(200,this)}return}else{d=this.items.get(this.items.getCount()-1);if(d){if(this.backspaceDeletesLastItem){this.on("expand",function(){this.collapse()},this,{single:true});d.preDestroy(true)}else{if(this.navigateItemsWithTab){d.onElClick()}else{this.on("expand",function(){this.collapse();this.currentFocus=d;this.currentFocus.onLnkFocus.defer(20,this.currentFocus)},this,{single:true})}}}return true}}if(!g.isNavKeyPress()){this.multiSelectMode=false;this.clearCurrentFocus();return}if(g.getKey()===g.LEFT||(g.getKey()===g.UP&&!this.isExpanded())){g.stopEvent();this.collapse();d=this.items.get(this.items.getCount()-1);if(this.navigateItemsWithTab){if(d){d.focus()}}else{if(this.currentFocus){a=this.items.indexOfKey(this.currentFocus.key);this.clearCurrentFocus();if(a!==0){this.currentFocus=this.items.itemAt(a-1);this.currentFocus.onLnkFocus()}}else{this.currentFocus=d;if(d){d.onLnkFocus()}}}return true}if(g.getKey()===g.DOWN){if(this.currentFocus){this.collapse();g.stopEvent();a=this.items.indexOfKey(this.currentFocus.key);if(a==(this.items.getCount()-1)){this.clearCurrentFocus.defer(10,this)}else{this.clearCurrentFocus();this.currentFocus=this.items.itemAt(a+1);if(this.currentFocus){this.currentFocus.onLnkFocus()}}return true}}if(g.getKey()===g.RIGHT){this.collapse();d=this.items.itemAt(0);if(this.navigateItemsWithTab){if(d){d.focus()}}else{if(this.currentFocus){a=this.items.indexOfKey(this.currentFocus.key);this.clearCurrentFocus();if(a<(this.items.getCount()-1)){this.currentFocus=this.items.itemAt(a+1);if(this.currentFocus){this.currentFocus.onLnkFocus()}}}else{this.currentFocus=d;if(d){d.onLnkFocus()}}}}},onKeyUpBuffered:function(a){if(!a.isNavKeyPress()){this.autoSize()}},reset:function(){this.killItems();Ext.ux.form.SuperBoxSelect.superclass.reset.call(this);this.addedRecords=[];this.autoSize().setRawValue("")},applyEmptyText:function(){this.setRawValue("");if(this.items.getCount()>0){this.el.removeClass(this.emptyClass);this.setRawValue("");return this}if(this.rendered&&this.emptyText&&this.getRawValue().length<1){this.setRawValue(this.emptyText);this.el.addClass(this.emptyClass)}return this},removeAllItems:function(){this.items.each(function(a){a.preDestroy(true)},this);this.manageClearBtn();return this},killItems:function(){this.items.each(function(a){a.kill()},this);this.resetStore();this.items.clear();this.manageClearBtn();return this},resetStore:function(){this.store.clearFilter();if(!this.removeValuesFromStore){return this}this.usedRecords.each(function(a){this.store.add(a)},this);this.usedRecords.clear();this.sortStore();return this},sortStore:function(){var a=this.store.getSortState();if(a&&a.field){this.store.sort(a.field,a.direction)}return this},getCaption:function(c){if(typeof this.displayFieldTpl==="string"){this.displayFieldTpl=new Ext.XTemplate(this.displayFieldTpl)}var b,a=c instanceof Ext.data.Record?c.data:c;if(this.displayFieldTpl){b=this.displayFieldTpl.apply(a)}else{if(this.displayField){b=a[this.displayField]}}return b},addRecord:function(b){var e=b.data[this.displayField],c=this.getCaption(b),f=b.data[this.valueField],a=this.classField?b.data[this.classField]:"",d=this.styleField?b.data[this.styleField]:"";if(this.removeValuesFromStore){this.usedRecords.add(f,b);this.store.remove(b)}this.addItemBox(f,e,c,a,d);this.fireEvent("additem",this,f,b)},createRecord:function(a){if(!this.recordConstructor){var b=[{name:this.valueField},{name:this.displayField}];if(this.classField){b.push({name:this.classField})}if(this.styleField){b.push({name:this.styleField})}this.recordConstructor=Ext.data.Record.create(b)}return new this.recordConstructor(a)},addItems:function(a){if(Ext.isArray(a)){Ext.each(a,function(b){this.addItem(b)},this)}else{this.addItem(a)}},addNewItem:function(a){this.addItem(a,true)},addItem:function(a,c){var e=a[this.valueField];if(this.disabled){return false}if(this.preventDuplicates&&this.hasValue(e)){return}var b=this.findRecord(this.valueField,e);if(b){this.addRecord(b);return}else{if(!this.allowAddNewData){return}}if(this.mode==="remote"){this.remoteLookup.push(a);this.doQuery(e,false,false,c);return}var d=this.createRecord(a);this.store.add(d);this.addRecord(d);return true},addItemBox:function(c,e,i,h,d){var f,g=function(k){var j="";if(typeof k=="function"){j=k.call()}else{if(typeof k=="object"){for(var l in k){j+=l+":"+k[l]+";"}}else{if(typeof k=="string"){j=k+";"}}}return j},a=Ext.id(null,"sbx-item"),b=new Ext.ux.form.SuperBoxSelectItem({owner:this,disabled:this.disabled,renderTo:this.wrapEl,cls:this.extraItemCls+" "+h,style:g(this.extraItemStyle)+" "+d,caption:i,display:e,value:c,key:a,listeners:{remove:function(j){if(this.fireEvent("beforeremoveitem",this,j.value)===false){return}this.items.removeKey(j.key);if(this.removeValuesFromStore){if(this.usedRecords.containsKey(j.value)){this.store.add(this.usedRecords.get(j.value));this.usedRecords.removeKey(j.value);this.sortStore();if(this.view){this.view.render()}}}if(!this.preventMultipleRemoveEvents){this.fireEvent.defer(250,this,["removeitem",this,j.value,this.findInStore(j.value)])}},destroy:function(){this.collapse();this.autoSize().manageClearBtn().validateValue()},scope:this}});b.render();f={tag:"input",type:"hidden",value:c,name:(this.hiddenName||this.name)};if(this.disabled){Ext.apply(f,{disabled:"disabled"})}b.hidden=this.el.insertSibling(f,"before");this.items.add(a,b);this.applyEmptyText().autoSize().manageClearBtn().validateValue()},manageClearBtn:function(){if(!this.renderFieldBtns||!this.rendered){return this}var a="x-superboxselect-btn-hide";if(this.items.getCount()===0){this.buttonClear.addClass(a)}else{this.buttonClear.removeClass(a)}return this},findInStore:function(b){var a=this.store.find(this.valueField,b);if(a>-1){return this.store.getAt(a)}return false},getValue:function(){var a=[];this.items.each(function(b){a.push(b.value)});return a.join(this.valueDelimiter)},getValueEx:function(){var a=[];this.items.each(function(c){var b={};b[this.valueField]=c.value;b[this.displayField]=c.display;if(this.classField){b[this.classField]=c.cls||""}if(this.styleField){b[this.styleField]=c.style||""}a.push(b)},this);return a},initValue:function(){Ext.ux.form.SuperBoxSelect.superclass.initValue.call(this);if(this.mode==="remote"){this.setOriginal=true}},setValue:function(c){if(!this.rendered){this.value=c;return}this.removeAllItems().resetStore();this.remoteLookup=[];if(Ext.isEmpty(c)){return}var a=c;if(!Ext.isArray(c)){c=""+c;a=c.split(this.valueDelimiter)}Ext.each(a,function(e){var d=this.findRecord(this.valueField,e);if(d){this.addRecord(d)}else{if(this.mode==="remote"){this.remoteLookup.push(e)}}},this);if(this.mode==="remote"){var b=this.remoteLookup.join(this.queryValuesDelimiter);this.doQuery(b,false,true)}},setValueEx:function(a){this.removeAllItems().resetStore();if(!Ext.isArray(a)){a=[a]}this.remoteLookup=[];if(this.allowAddNewData&&this.mode==="remote"){Ext.each(a,function(c){var b=this.findRecord(this.valueField,c[this.valueField])||this.createRecord(c);this.addRecord(b)},this);return}Ext.each(a,function(b){this.addItem(b)},this)},hasValue:function(b){var a=false;this.items.each(function(c){if(c.value==b){a=true;return false}},this);return a},onSelect:function(a,b){if(this.fireEvent("beforeselect",this,a,b)!==false){var c=a.data[this.valueField];if(this.preventDuplicates&&this.hasValue(c)){return}this.setRawValue("");this.lastSelectionText="";if(this.fireEvent("beforeadditem",this,c)!==false){this.addRecord(a)}if(this.store.getCount()===0||!this.multiSelectMode){this.collapse()}else{this.restrictHeight()}}},onDestroy:function(){this.items.purgeListeners();this.killItems();if(this.renderFieldBtns){Ext.destroy(this.buttonClear,this.buttonExpand,this.buttonWrap)}Ext.destroy(this.inputEl,this.wrapEl,this.outerWrapEl);Ext.ux.form.SuperBoxSelect.superclass.onDestroy.call(this)},autoSize:function(){if(!this.rendered){return this}if(!this.metrics){this.metrics=Ext.util.TextMetrics.createInstance(this.el)}var c=this.el,b=c.dom.value,e=document.createElement("div");if(b===""&&this.emptyText&&this.items.getCount()<1){b=this.emptyText}e.appendChild(document.createTextNode(b));b=e.innerHTML;e=null;b+="&#160;";var a=Math.max(this.metrics.getWidth(b)+24,24);if(typeof this._width!="undefined"){a=Math.min(this._width,a)}this.el.setWidth(a);if(Ext.isIE){this.el.dom.style.top="0"}return this},doQuery:function(e,d,a,c){e=Ext.isEmpty(e)?"":e;var b={query:e,forceAll:d,combo:this,cancel:false};if(this.fireEvent("beforequery",b)===false||b.cancel){return false}e=b.query;d=b.forceAll;if(d===true||(e.length>=this.minChars)||a&&!Ext.isEmpty(e)){if(this.lastQuery!==e||c){this.lastQuery=e;if(this.mode=="local"){this.selectedIndex=-1;if(d){this.store.clearFilter()}else{this.store.filter(this.displayField,e)}this.onLoad()}else{this.store.baseParams[this.queryParam]=e;this.store.baseParams[this.queryValuesIndicator]=a;this.store.load({params:this.getParams(e)});if(!c){this.expand()}}}else{this.selectedIndex=-1;this.onLoad()}}}});Ext.reg("superboxselect",Ext.ux.form.SuperBoxSelect);Ext.ux.form.SuperBoxSelectItem=function(a){Ext.apply(this,a);Ext.ux.form.SuperBoxSelectItem.superclass.constructor.call(this)};Ext.ux.form.SuperBoxSelectItem=Ext.extend(Ext.ux.form.SuperBoxSelectItem,Ext.Component,{initComponent:function(){Ext.ux.form.SuperBoxSelectItem.superclass.initComponent.call(this)},onElClick:function(b){var c=this.owner;c.clearCurrentFocus().collapse();if(c.navigateItemsWithTab){this.focus()}else{c.el.dom.focus();var a=this;(function(){this.onLnkFocus();c.currentFocus=this}).defer(10,this)}},onLnkClick:function(a){if(a){a.stopEvent()}this.preDestroy();if(!this.owner.navigateItemsWithTab){this.owner.el.focus()}},onLnkFocus:function(){this.el.addClass("x-superboxselect-item-focus");this.owner.outerWrapEl.addClass("x-form-focus")},onLnkBlur:function(){this.el.removeClass("x-superboxselect-item-focus");this.owner.outerWrapEl.removeClass("x-form-focus")},enableElListeners:function(){this.el.on("click",this.onElClick,this,{stopEvent:true});this.el.addClassOnOver("x-superboxselect-item x-superboxselect-item-hover")},enableLnkListeners:function(){this.lnk.on({click:this.onLnkClick,focus:this.onLnkFocus,blur:this.onLnkBlur,scope:this})},enableAllListeners:function(){this.enableElListeners();this.enableLnkListeners()},disableAllListeners:function(){this.el.removeAllListeners();this.lnk.un("click",this.onLnkClick,this);this.lnk.un("focus",this.onLnkFocus,this);this.lnk.un("blur",this.onLnkBlur,this)},onRender:function(c,a){Ext.ux.form.SuperBoxSelectItem.superclass.onRender.call(this,c,a);var e=this.el;if(e){e.remove()}this.el=e=c.createChild({tag:"li"},c.last());e.addClass("x-superboxselect-item");var d=this.owner.navigateItemsWithTab?(Ext.isSafari?"button":"a"):"span";var f=this.key;Ext.apply(e,{focus:function(){var g=this.down(d+".x-superboxselect-item-close");if(g){g.focus()}},preDestroy:function(){this.preDestroy()}.createDelegate(this)});this.enableElListeners();e.update(this.caption);var b={tag:d,"class":"x-superboxselect-item-close",tabIndex:this.owner.navigateItemsWithTab?"0":"-1"};if(d==="a"){b.href="#"}this.lnk=e.createChild(b);if(!this.disabled){this.enableLnkListeners()}else{this.disableAllListeners()}this.on({disable:this.disableAllListeners,enable:this.enableAllListeners,scope:this});this.setupKeyMap()},setupKeyMap:function(){this.keyMap=new Ext.KeyMap(this.lnk,[{key:[Ext.EventObject.BACKSPACE,Ext.EventObject.DELETE,Ext.EventObject.SPACE],fn:this.preDestroy,scope:this},{key:[Ext.EventObject.RIGHT,Ext.EventObject.DOWN],fn:function(){this.moveFocus("right")},scope:this},{key:[Ext.EventObject.LEFT,Ext.EventObject.UP],fn:function(){this.moveFocus("left")},scope:this},{key:[Ext.EventObject.HOME],fn:function(){var a=this.owner.items.get(0).el.focus();if(a){a.el.focus()}},scope:this},{key:[Ext.EventObject.END],fn:function(){this.owner.el.focus()},scope:this},{key:Ext.EventObject.ENTER,fn:function(){}}]);this.keyMap.stopEvent=true},moveFocus:function(a){var b=this.el[a=="left"?"prev":"next"]()||this.owner.el;b.focus.defer(100,b)},preDestroy:function(a){if(this.fireEvent("remove",this)===false){return}var b=function(){if(this.owner.navigateItemsWithTab){this.moveFocus("right")}this.hidden.remove();this.hidden=null;this.destroy()};if(a){b.call(this)}else{this.el.hide({duration:0.2,callback:b,scope:this})}return this},kill:function(){this.hidden.remove();this.hidden=null;this.purgeListeners();this.destroy()},onDisable:function(){if(this.hidden){this.hidden.dom.setAttribute("disabled","disabled")}this.keyMap.disable();Ext.ux.form.SuperBoxSelectItem.superclass.onDisable.call(this)},onEnable:function(){if(this.hidden){this.hidden.dom.removeAttribute("disabled")}this.keyMap.enable();Ext.ux.form.SuperBoxSelectItem.superclass.onEnable.call(this)},onDestroy:function(){Ext.destroy(this.lnk,this.el);Ext.ux.form.SuperBoxSelectItem.superclass.onDestroy.call(this)}});Ext.ns("Goliat.form");Goliat.form.RelationField=Ext.extend(Ext.form.TriggerField,{url:"",triggerClass:"x-form-relation-trigger",defaultAutoCreate:{tag:"input",type:"text",size:"24",autocomplete:"off"},emptyText:"",loadingText:"Loading...",relationModel:"Object",messages:{title:"Select a {0}",cancel:"Cancel",select:"Select"},initComponent:function(){Goliat.form.RelationField.superclass.initComponent.call(this);this.addEvents("select");if(this.url==""){return}this.modelStore=new Goliat.ModelStore({autoLoad:true,url:this.url})},onTriggerClick:function(){if(this.readOnly||this.disabled){return}this.sw=new Goliat.SelectionWindow({title:String.format(this.messages.title,this.relationModel),iconCls:"icon_search",items:new Ext.grid.GridPanel({store:this.modelStore.store,colModel:new Ext.grid.ColumnModel({defaults:{width:120,sortable:true},columns:this.modelStore.parseColumnModel()}),viewConfig:{forceFit:true},sm:new Ext.grid.RowSelectionModel({singleSelect:true}),width:600,height:300}),buttons:[{text:this.messages.cancel,iconCls:"icon_cancel",scope:this,handler:this.cancelButton_onClick},{text:this.messages.select,iconCls:"icon_select",scope:this,handler:this.selectButton_onClick}]});this.sw.show()},cancelButton_onClick:function(){this.sw.close()},selectButton_onClick:function(a,b){console.debug(a);console.debug(b)}});Ext.reg("relation",Goliat.form.RelationField);Ext.ns("Goliat.grid");Goliat.grid.BooleanImageColumn=Ext.extend(Ext.grid.Column,{constructor:function(a){Goliat.grid.BooleanImageColumn.superclass.constructor.call(this,a);this.renderer=Ext.util.Format.boolImage()}});Goliat.grid.BooleanCheckColumn=Ext.extend(Ext.grid.Column,{constructor:function(a){Goliat.grid.BooleanImageColumn.superclass.constructor.call(this,a);this.renderer=Ext.util.Format.boolCheck()}});Goliat.grid.ArrayColumn=Ext.extend(Ext.grid.Column,{constructor:function(a){Goliat.grid.ArrayColumn.superclass.constructor.call(this,a);this.renderer=Ext.util.Format.ellipsis(this.width,true)}});Ext.apply(Ext.grid.Column.types,{booleanimagecolumn:Goliat.grid.BooleanImageColumn,booleancheckcolumn:Goliat.grid.BooleanCheckColumn,arraycolumn:Goliat.grid.ArrayColumn});Goliat.ModelStore=function(a){Ext.apply(this,a);this.modelSchema=[];this.loaded=false;this.addEvents("onload","onflush");Goliat.ModelStore.superclass.constructor.call(this,a);if(this.autoLoad){this.load.defer(10,this)}};Ext.extend(Goliat.ModelStore,Ext.util.Observable,{messages:{transactionError:"Error with data transaction.",True:"True",False:"False",yes:"Yes",no:"No"},writer:new Ext.data.JsonWriter({encode:true,writeAllFields:false}),load:function(){if(!this.url){return{success:false,error:"No url setted."}}Ext.Ajax.request({method:"GET",url:this.url,params:{act:"getSchemaModel"},scope:this,callback:function(options,success,request){try{var response=eval("("+request.responseText+")")}catch(e){}if(!response){Goliat.Msg.error(this.messages.transactionError,this)}else{if(response.success===false){Goliat.Msg.error(response.error,this)}else{this.modelSchema=response.model;this.loaded=true;this.lookup={};for(c in this.modelSchema){if(c=="remove"){continue}this.lookup[this.modelSchema[c].name]=this.modelSchema[c]}if(!this.store){this.store=new Ext.data.JsonStore({id:this.url.replace(/\//g,""),proxy:new Ext.data.HttpProxy({api:{read:{url:this.url+"?act=view",method:"GET"},create:{url:this.url+"?act=create",method:"POST"},update:{url:this.url+"?act=update",method:"POST"},destroy:{url:this.url+"?act=delete",method:"POST"}}}),writer:this.writer,fields:this.getFields(),sortInfo:{field:"id",direction:"ASC"},autoSave:true});this.store.load()}this.fireEvent("onload",this)}}}})},reload:function(){this.load()},flush:function(){this.modelSchema=null;this.fireEvent("onflush",this)},setUrl:function(a){this.url=a},getModelSchema:function(){return this.modelSchema},getFieldById:function(a){return this.lookup[a]},hasRelation:function(b){for(var a=0;a<this.modelSchema.length;a++){if(this.modelSchema[a].relation!==true){continue}if(!this.modelSchema[a].config.localKey){localKey=this.modelSchema[a].config.foreignTable+"_"+this.modelSchema[a].config.foreignKey}else{localKey=this.modelSchema[a].config.localKey}if(b==localKey){return this.modelSchema[a].name}}return false},getIndexById:function(a){for(c in this.modelSchema){if(c=="remove"){continue}if(this.modelSchema[c].name==a){return c}}return -1},moveField:function(d,a){var b=this.modelSchema[d];this.modelSchema.splice(d,1);this.modelSchema.splice(a,0,b)},getFields:function(){fields=[];for(c in this.modelSchema){if(c=="remove"){continue}fields.push(this.modelSchema[c].name)}return fields},parseFormModel:function(){fields_model=Array();for(obj in this.modelSchema){if(!isNaN(obj)){field_data={};if(this.modelSchema[obj].relation===true){continue}else{field_data.fieldLabel=Ext.util.Format.capitalize(this.modelSchema[obj].name.replace(/_/g," "));field_data.name=this.modelSchema[obj].name;field_data.anchor="-10";(this.modelSchema[obj].required)?field_data.allowBlank=false:field_data.allowBlank=true;(Ext.isDefined(this.modelSchema[obj].config.size))?field_data.maxLength=this.modelSchema[obj].config.size:50;switch(this.parseType(this.modelSchema[obj])){case"string":if(Ext.isDefined(this.modelSchema[obj].config.size)&&this.modelSchema[obj].config.size<=100){field_data.xtype="textfield"}else{if(Ext.isDefined(this.modelSchema[obj].config.size)&&this.modelSchema[obj].config.size>100){field_data.xtype="textarea"}else{field_data.xtype="textfield"}}break;case"number":field_data.xtype="numberfield";break;case"real":field_data.xtype="numberfield";field_data.allowDecimals=true;field_data.decimalPrecision=2;break;case"boolean":field_data.xtype="radiogroup";field_data.columns="auto";field_data.items=[{inputValue:"0",boxLabel:this.messages.yes},{inputValue:"1",boxLabel:this.messages.no}];break;case"date":case"datetime":field_data.xtype="datefield";break;case"time":field_data.xtype="timefield";break;case"list":field_data.xtype="multiselect";break;default:field_data.xtype="textfield"}if(this.modelSchema[obj].config.primaryKey){field_data.xtype="hidden"}fields_model.push(field_data)}}}return fields_model},parseColumnModel:function(){columns_model=Array();for(obj in this.modelSchema){if(!isNaN(obj)){column_data={};if(this.modelSchema[obj].relation===true){continue}column_data.header=Ext.util.Format.capitalize(this.modelSchema[obj].name.replace(/_/g," "));column_data.dataIndex=this.modelSchema[obj].name;(this.modelSchema[obj].size)?column_data.width=this.modelSchema[obj].size:80;column_data.sortable=true;column_data.id=this.modelSchema[obj].name;column_data.sqlType=this.parseType(this.modelSchema[obj]);switch(this.parseType(this.modelSchema[obj])){case"string":column_data.xtype="gridcolumn";break;case"number":column_data.xtype="numbercolumn";column_data.format="0";break;case"real":column_data.xtype="numbercolumn";column_data.format="0.00";break;case"boolean":if(this.boolImage){column_data.xtype="booleanimagecolumn"}else{if(this.boolCheck){column_data.xtype="booleancheckcolumn"}else{column_data.xtype="booleancolumn"}}break;case"date":case"time":case"datetime":column_data.xtype="datecolumn";break;case"list":column_data.xtype="arraycolumn";break;default:column_data.xtype="gridcolumn";break}if(this.modelSchema[obj].config.primaryKey){column_data.primary=true}else{column_data.primary=false}columns_model.push(column_data)}}return columns_model},parseType:function(a){type=null;switch(a.config.type.toLowerCase()){case"varchar":case"longvarchar":case"unicode":case"rawstr":case"any":type="string";break;case"integer":case"smallint":case"longint":case"serial":case"bigserial":type="number";break;case"real":case"float":case"double":case"decimal":type="real";break;case"bool":case"boolean":type="boolean";break;case"date":type="date";break;case"time":type="time";break;case"timestamp":type="datetime";break;case"timedelta":type="time";break;case"list":type="array";break;default:type="string";break}return type}});Ext.namespace("Goliat.data");Goliat.data.JsonRequest=function(a,b){method=a.method.toUpperCase();Ext.Ajax.request({method:method,url:a.url,params:a.data||{},scope:a.scope,callback:function(d,h,c){Ext.getBody().unmask();if(h===true){var f;try{f=Ext.decode(c.responseText)}catch(g){Goliat.Msg.error("The returned data is not valid data.",this)}if(b){b.call(d.scope||window,f,d)}}else{Goliat.Msg.error("Web transaction failed!",this)}}})};Goliat.StompClient=function(a){this.options=a;this.socket=Orbited.TCPSocket;this.stomp=undefined;this.verbose=false;this.addEvents("onstompopen","onstompclose","onstomperror","onstomperrorframe","onstompconnectedframe","onstompmessageframe");Goliat.StompClient.superclass.constructor.call(this,a)};Ext.extend(Goliat.StompClient,Ext.util.Observable,{subscribeError:"The stomp service tried to start but there is no channel to subscribe",onopenMessage:"Stomp transport connection was successful.",opcloseMessage:"Stomp connection lost.<br />Reconnection attempt.",onerrorMessage:"Stomp service received an error:<br />",onerrroframeMessage:"Stompservice received an error:<br />",onconnecterrorMessage:"The Stomp Client tried to connect, but seems like the service is not configured.",getSocket:function(){return this.socket},getStomp:function(){return this.stomp},stompInit:function(){if(Ext.isEmpty(this.options.channel)){Goliat.Msg.error(this.subscribeError);return}this.stomp=new STOMPClient();this.stomp.onopen=function(){if(this.verbose){Goliat.Msg.alert(onopenMessage)}this.fireEvent("onstompopen",this)};this.stomp.onclose=function(a){Goliat.Msg.error(oncloseMessage);this.stomp.connect();this.fireEvent("onstompclose",this,a)};this.stomp.onerror=function(a){Goliat.Msg.error(onerrorMessage+a);this.fireEvent("onstomperror",this,a)};this.stomp.onerrorframe=function(a){Goliat.Msg.error(onerrorframeMessage+a.body);this.fireEvent("onstomperrorframe",this,a)};this.stomp.onconnectedframe=function(){this.stomp.subscribe(this.options.channel);this.stomp.ready=true;this.fireEvent("onstompconnectedfram",this)};this.stomp.onmessageframe=function(a){this.fireEvent("onstompmessageframe",this,a)}},stompConnect:function(){if(!this.stomp.ready){Goliat.Msg.error(this.onconnecterrorMessage);return}if(Ext.isEmpty(this.options.port)){this.options.port=61613}this.stomp.connect(document.domain,this.options.port)},stompDisconnect:function(){this.stomp.disconnect()},stompChannel:function(a){this.options.channel=a},stompPort:function(a){this.options.port=a},changeSubscription:function(a){this.stomp.unsubscribe(this.options.channel);this.options.channel=a;this.stomp.subscribe(a)},onSend:function(a){this.stomp.send(Ext.util.JSON.encode(a),this.options.channel)}});Ext.ns("Goliat.util");Goliat.util.Format=function(){return{boolImage:function(a){if(a){return'<img class="icon_on" src="/extjs/resources/images/default/s.gif" title="Running" style="margin: -1px 4px -1px 0; width: 16px; height: 16px; vertical-align: middle;" />'}else{return'<img class="icon_off" src="/extjs/resources/images/default/s.gif" title="Down" style="margin: -1px 4px -1px 0; width: 16px; height: 16px; vertical-align: middle;" />'}},boolCheck:function(a){if(a){return'<input type="checkbox" value="true" checked="checked" />'}else{return'<input type="checkbox" value="false" />'}},eurMoney:function(a){a=(Math.round((a-0)*100))/100;a=(a==Math.floor(a))?a+".00":((a*10==Math.floor(a*10))?a+"0":a);a=String(a);var e=a.split("."),d=e[0],b=e[1]?"."+e[1]:".00",c=/(\d+)(\d{3})/;while(c.test(d)){d=d.replace(c,"$1,$2")}a=d+b;if(a.charAt(0)=="-"){return"-"+a.substr(1)+""}return a+""}}}();Ext.apply(Ext.util.Format,Goliat.util.Format);Ext.ns("Goliat.util");Goliat.util.Logger=Ext.extend(Ext.BoxComponent,{tpl:new Ext.Template('<li class="x-log-entry x-log-{0:lowercase}-entry">','<div class="x-log-level">','   <span class="x-log-time">',"       {2:date([H:i:s.u])}","   </span>",'   <span class="x-log-message">',"       {1}","   </span>","</div>","</li>"),autoEl:{tag:"ul",cls:"x-logger x-log-show-info"},last:undefined,startMessage:"Starting Log Console...",onRender:function(){Goliat.util.Logger.superclass.onRender.apply(this,arguments);this.contextMenu=new Ext.menu.Menu({items:[new Ext.menu.CheckItem({id:"debug",text:"Debug",checkHandler:Goliat.util.Logger.prototype.onMenuCheck,scope:this}),new Ext.menu.CheckItem({id:"info",text:"Info",checkHandler:Goliat.util.Logger.prototype.onMenuCheck,scope:this,checked:true}),new Ext.menu.CheckItem({id:"warning",text:"Warning",checkHandler:Goliat.util.Logger.prototype.onMenuCheck,scope:this}),new Ext.menu.CheckItem({id:"error",text:"Error",checkHandler:Goliat.util.Logger.prototype.onMenuCheck,scope:this})]});this.el.on("contextmenu",this.onContextMenu,this,{stopEvent:true});this.last=this.tpl.insertFirst(this.el,["debug",this.startMessage,new Date()])},onContextMenu:function(a){this.contextMenu.logger=this;this.contextMenu.showAt(a.getXY())},onMenuCheck:function(b,d){var c=b.parentMenu.logger;var a="x-log-show-"+b.id;if(d){c.el.addClass(a)}else{c.el.removeClass(a)}},debug:function(a){this.last=this.tpl.insertAfter(this.last,["debug",a,new Date()]);this.el.scroll("bottom",this.el.getHeight(),false)},info:function(a){this.last=this.tpl.insertAfter(this.last,["info",a,new Date()]);this.el.scroll("bottom",this.el.getHeight(),false)},warning:function(a){this.last=this.tpl.insertAfter(this.last,["warning",a,new Date()]);this.el.scroll("bottom",this.el.getHeight(),false)},error:function(a){this.last=this.tpl.insertAfter(this.last,["error",a,new Date()]);this.el.scroll("bottom",this.el.getHeight(),false)}});Ext.reg("Goliat_logger",Goliat.util.Logger);Ext.ns("Goliat.util");Goliat.util.DomHelper=Ext.extend(Object,{constructor:function(a){this.listeners=a.listeners?a.listeners:a},init:function(d){var b,a=this.listeners;for(b in a){if(Ext.isFunction(a[b])){a[b]=this.createHandler(a[b],d)}else{a[b].fn=this.createHandler(a[b].fn,d)}}d.render=d.render.createSequence(function(){var c=d.getEl();if(c){c.on(a)}})},createHandler:function(a,b){return function(c){a.call(this,c,b)}}});Ext.ns("Goliat.layout");Goliat.layout.TwoColumnsFLayout=Ext.extend(Object,{type:"goliat-layout",items:[],constructor:function(){this.setup()},setup:function(){sidePanel=new Goliat.SidePanel({itemId:"sidePanel",region:"west",width:208,split:true,minSize:208,maxSize:400,bodyStyle:"background: #ffffff;",items:[]});centerPanel=new Ext.Panel({layout:"fit",itemId:"centerPanel",region:"center",plain:true,enableTabScroll:true,style:"padding: 8px 8px 8px 0;",items:[]});bottomPanel=new Ext.Panel({itemId:"bottomPanel",region:"south",height:100,minSize:100});this.items=[sidePanel,centerPanel,bottomPanel]}});Ext.ns("Goliat.layout");Goliat.layout.DisplayLayout=Ext.extend(Ext.layout.FormLayout,{background:"none",onLayout:function(a,b){Goliat.layout.DisplayLayout.superclass.onLayout.apply(this,arguments);b.addClass("x-goliat-display-background-"+this.background);if(this.declaration&&!this.declEl){this.declEl=b.createChild({dom:"div",html:this.declaration,"class":"x-goliat-display-declaration x-goliat-display-background-declaration"})}},destroy:function(){if(this.declEl){thid.declEl.remove()}Goliat.layout.DisplayLayout.superclass.destroy.call(this)}});Ext.Container.LAYOUTS.display=Goliat.layout.DisplayLayout;Ext.ns("Goliat.layout");Goliat.layout.TwoColumnsLayout=Ext.extend(Object,{type:"goliat-layout",items:[],constructor:function(){this.setup()},setup:function(){sidePanel=new Goliat.SidePanel({itemId:"sidePanel",region:"west",width:208,split:true,minSize:208,maxSize:400,bodyStyle:"background: #ffffff;",items:[]});centerPanel=new Ext.Panel({layout:"fit",itemId:"centerPanel",region:"center",plain:true,enableTabScroll:true,style:"padding: 8px 8px 8px 0;",items:[]});this.items=[sidePanel,centerPanel]}});Ext.ns("Goliat.layout");Goliat.layout.ThreeColumnsLayout=Ext.extend(Object,{type:"goliat-layout",items:[],constructor:function(){this.setup()},setup:function(){sidePanel=new Goliat.SidePanel({itemId:"sidePanel",region:"west",width:208,split:true,minSize:208,maxSize:400,bodyStyle:"background: #ffffff;",items:[]});sidePanel2=new Goliat.SidePanel({itemId:"sidePanel2",region:"east",width:208,split:true,minSize:208,maxSize:400,bodyStyle:"background: #ffffff;",items:[]});centerPanel=new Ext.Panel({layout:"fit",itemId:"centerPanel",region:"center",plain:true,enableTabScroll:true,style:"padding: 8px 8px 8px 0;",items:[]});this.items=[sidePanel,centerPanel,sidePanel2]}});Ext.ns("Goliat.layout");Goliat.layout.ThreeColumnsFLayout=Ext.extend(Object,{type:"goliat-layout",items:[],constructor:function(){this.setup()},setup:function(){sidePanel=new Goliat.SidePanel({itemId:"sidePanel",region:"west",width:208,split:true,minSize:208,maxSize:400,bodyStyle:"background: #ffffff;",items:[]});sidePanel2=new Goliat.SidePanel({itemId:"sidePanel2",region:"east",width:208,split:true,minSize:208,maxSize:400,bodyStyle:"background: #ffffff;",items:[]});centerPanel=new Ext.Panel({layout:"fit",itemId:"centerPanel",region:"center",plain:true,enableTabScroll:true,style:"padding: 8px 0 8px 0;",items:[]});bottomPanel=new Ext.Panel({itemId:"bottomPanel",region:"south",height:100,minSize:100});this.items=[sidePanel,centerPanel,sidePanel2,bottomPanel]}});Ext.ns("Goliat.layout");Goliat.layout.MainWindowLayout=Ext.extend(Object,{type:"goliat-layout",items:[],constructor:function(){this.setup()},setup:function(){centerPanel=new Ext.Panel({layout:"fit",itemId:"centerPanel",region:"center",plain:true,enableTabScroll:true,style:"padding: 0px;",items:[]});this.items=[centerPanel]}});Ext.ns("Goliat.layout");Goliat.layout.ThreeColumnsFhLayout=Ext.extend(Object,{type:"goliat-layout",items:[],constructor:function(){this.setup()},setup:function(){sidePanel=new Goliat.SidePanel({itemId:"sidePanel",region:"west",width:208,split:true,minSize:208,maxSize:400,bodyStyle:"background: #ffffff;",items:[]});sidePanel2=new Goliat.SidePanel({itemId:"sidePanel2",region:"east",width:208,split:true,minSize:208,maxSize:400,bodyStyle:"background: #ffffff;",items:[]});centerPanel=new Ext.Panel({layout:"fit",itemId:"centerPanel",region:"center",plain:true,enableTabScroll:true,style:"padding: 8px 0px 8px 0;",items:[]});topPanel=new Ext.Panel({itemId:"topPanel",region:"north",height:60,minSize:60});bottomPanel=new Ext.Panel({itemId:"bottomPanel",region:"south",height:100,minSize:100});this.items=[sidePanel,centerPanel,sidePanel2,topPanel,bottomPanel]}});Ext.ns("Goliat.layout");Goliat.layout.TwoColumnsHLayout=Ext.extend(Object,{type:"goliat-layout",items:[],constructor:function(){this.setup()},setup:function(){sidePanel=new Goliat.SidePanel({itemId:"sidePanel",region:"west",layout:"fit",width:208,split:true,minSize:208,maxSize:400,bodyStyle:"background: #ffffff;",items:[]});centerPanel=new Ext.Panel({layout:"fit",itemId:"centerPanel",region:"center",plain:true,enableTabScroll:true,style:"padding: 8px 8px 8px 0;",items:[]});topPanel=new Ext.Panel({itemId:"topPanel",region:"north",height:60,minSize:60});this.items=[sidePanel,centerPanel,topPanel]}});Ext.ns("Goliat.layout");Goliat.layout.TwoColumnsFhLayout=Ext.extend(Object,{type:"goliat-layout",items:[],constructor:function(){this.setup()},setup:function(){sidePanel=new Goliat.SidePanel({itemId:"sidePanel",region:"west",width:208,split:true,minSize:208,maxSize:400,bodyStyle:"background: #ffffff;",items:[]});centerPanel=new Ext.Panel({layout:"fit",itemId:"centerPanel",region:"center",plain:true,enableTabScroll:true,style:"padding: 8px 8px 8px 0;",items:[]});topPanel=new Ext.Panel({itemId:"topPanel",region:"north",height:60,minSize:60});bottomPanel=new Ext.Panel({itemId:"bottomPanel",region:"south",height:100,minSize:100});this.items=[sidePanel,centerPanel,topPanel,bottomPanel]}});Ext.ns("Goliat.layout");Goliat.layout.ThreeColumnsLayout=Ext.extend(Object,{type:"goliat-layout",items:[],constructor:function(){this.setup()},setup:function(){sidePanel=new Goliat.SidePanel({itemId:"sidePanel",region:"west",width:208,split:true,minSize:208,maxSize:400,bodyStyle:"background: #ffffff;",items:[]});sidePanel2=new Goliat.SidePanel({itemId:"sidePanel2",region:"east",width:208,split:true,minSize:208,maxSize:400,bodyStyle:"background: #ffffff;",items:[]});centerPanel=new Ext.Panel({layout:"fit",itemId:"centerPanel",region:"center",plain:true,enableTabScroll:true,style:"padding: 8px 0 8px 0;",items:[]});topPanel=new Ext.Panel({itemId:"topPanel",region:"north",height:60,minSize:60});this.items=[sidePanel,centerPanel,sidePanel2,topPanel]}});Ext.ns("Goliat.display");Goliat.display.TextArea=Ext.extend(Ext.form.TextArea,{readOnly:true,cls:"x-goliat-display-textarea"});Ext.reg("Goliat_displaytextarea",Goliat.display.TextArea);Ext.ns("Goliat.display");Goliat.display.DisplayPanel=Ext.extend(Ext.form.FormPanel,{cls:"x-goliat-display",layout:"display",itemId:"displayPanel",loadRecord:function(a){return this.getForm().loadRecord(a)},onRender:function(){this.supr().onRender.apply(this,arguments)}});Ext.reg("Goliat_displaypanel",Goliat.display.DisplayPanel);Ext.ns("Goliat.display");Goliat.display.DisplayField=Ext.extend(Ext.form.DisplayField,{htmlEncode:true,nl2br:false,renderer:function(a){return a},setRawValue:function(b){var a=this.renderer(b);if(this.htmlEncode){a=Ext.util.Format.htmlEncode(a)}if(this.nl2br){a=Ext.util.Format.nl2br(a)}return this.rendered?(this.el.dom.innerHTML=(Ext.isEmpty(a)?"":a)):(this.value=a)}});Ext.reg("Goliat_displayfield",Goliat.display.DisplayField);Ext.ns("Goliat");Goliat.LogPanel=Ext.extend(Ext.Panel,{layout:"fit",enableTabScroll:true,autoScroll:true,margins:"0 0 0 0",bodyStyle:"padding-left: 10px; font-size: 10px;",initComponent:function(){this.logger=new Goliat.util.Logger();this.items=this.logger;Goliat.LogPanel.superclass.initComponent.call(this)},registerLog:function(a,b){switch(a){case"debug":this.logger.debug(b);break;case"warn":this.logger.warning(b);break;case"error":this.logger.error(b);break;default:this.logger.info(b)}}});Ext.reg("Goliat_logpanel",Goliat.LogPanel);Ext.ns("Goliat");Goliat.MessageBox=function(){var b={modal:true,resizable:false,closable:false,border:false,constraint:true,constrainHeader:true,stateful:false,plain:true,footer:true,shim:true,bodyStyle:"padding: 8px;",buttonAlign:"center"};var a=false;return{informationText:"Information",confirmText:"Confirmation",errorText:"Error",acceptText:"Accept",yesText:"Yes",noText:"No",show:function(c){Ext.apply(b,c);Ext.apply(b,{autoWidth:true});a=new Ext.Window(b);a.show()},alert:function(d,c,e){this.show({html:d,iconCls:"icon_information",title:this.informationText,buttons:[new Ext.Button({minWidth:80,iconCls:"icon_accept",text:this.acceptText,scope:this,handler:function(){a.close()}})]});return this},confirm:function(d,c,e){this.show({html:d,iconCls:"icon_confirm",title:this.confirmText,buttons:[new Ext.Button({minWidth:80,iconCls:"icon_accept",text:this.yesText,scope:this,handler:function(){a.close();if(e){e.call(c||window,"yes")}}}),new Ext.Button({minWidth:80,iconCls:"icon_cancel",text:this.noText,scope:this,handler:function(){a.close();if(e){e.call(c||window,"no")}}})]});return this},error:function(d,c,e){this.show({html:d,iconCls:"icon_error",title:this.errorText,buttons:[new Ext.Button({minWidth:80,iconCls:"icon_accept",text:this.acceptText,scope:this,handler:function(){a.close();if(e){e.call(c||window,"ok")}}})]});return this}}}();Goliat.Msg=Goliat.MessageBox;Ext.ns("Goliat");Goliat.EditorWindow=Ext.extend(Ext.Window,{layout:"fit",width:(Ext.isIE)?620:590,height:(Ext.isIE)?255:245,modal:true,resizable:true,draggable:true,center:true,closable:false,messages:{titlenew:"Add new {0}",titleedit:"Editing : {0}",saving:"Saving {0}...",cancel:"Cancel",save:"Save"},initComponent:function(){Ext.applyIf(this,{title:this.configureTitle(),iconCls:(this.record)?"icon_edit_edit":"icon_edit_add",items:this.buildItems(),buttons:this.buildButtons()});this.addEvents({recordsaved:true});Goliat.EditorWindow.superclass.initComponent.call(this)},buildItems:function(){return new Goliat.base.FormPanel({url:this.url,bodyStyle:"padding: 10px",layout:"form",border:false,itemId:"recordForm",record:this.record,items:[this.modelStore.parseFormModel()],tbar:null})},buildButtons:function(){return[{text:this.messages.cancel,iconCls:"icon_cancel",scope:this,handler:this.cancelButton_onClick},{text:this.messages.save,iconCls:"icon_save",scope:this,handler:this.saveButton_onClick}]},configureTitle:function(){if(this.record&&this.record instanceof Ext.data.Record){return String.format(this.messages.titleedit,(this.grid.nameKey)?this.record.get(this.grid.nameKey):this.record.get("name"))}else{return String.format((Ext.isDefined(this.grid)&&Ext.isDefined(this.grid.titleName))?this.grid.titleName:"Record")}},cancelButton_onClick:function(){this.close()}});